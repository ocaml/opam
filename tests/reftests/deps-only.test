N0REP0
### <pkg:foo.1>
opam-version: "2.0"
### <pkg:foo.2>
opam-version: "2.0"
depends: "truc"
### <pkg:bar.1>
opam-version: "2.0"
depends: "foo" {= "1"}
### <pkg:baz.1>
opam-version: "2.0"
depends: "bar"
### <pkg:baz.1>
opam-version: "2.0"
depends: "bar"
### <pkg:truc.1>
opam-version: "2.0"
depopts: "foo" { < "2" }
### OPAMYES=1
### opam switch create x --empty
### OPAMSHOW=1
### opam install --deps-only foo
The following actions would be performed:
=== install 1 package
  - install truc 1 [required by foo]
### opam install --deps-only bar
The following actions would be performed:
=== install 1 package
  - install foo 1 [required by bar]
### opam install --deps-only baz
The following actions would be performed:
=== install 2 packages
  - install bar 1 [required by baz]
  - install foo 1 [required by bar]
### opam install --deps-only foo bar
Nothing to do.
### opam install --deps-only foo baz
[ERROR] Package conflict!
  * Incompatible packages:
    - deps-of-baz -> bar -> foo < 2
    - deps-of-foo

No solution found, exiting
# Return code 20 #
### opam install --deps-only bar baz
The following actions would be performed:
=== install 1 package
  - install foo 1 [required by bar]
### opam install --deps-only foo bar baz
Nothing to do.
### opam install --deps-only truc
Nothing to do.
### opam install --deps-only truc baz
The following actions would be performed:
=== install 2 packages
  - install bar 1 [required by baz]
  - install foo 1 [required by bar]
### ::::::::::::::::::: Test for #4911 ::::::::::::::::
### OPAMSHOW=0
### <pkg:buz.1>
opam-version: "2.0"
depopts: "bar"
### opam install foo.1 buz
The following actions will be performed:
=== install 2 packages
  - install buz 1
  - install foo 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed buz.1
-> installed foo.1
Done.
### opam list --roots -s
buz
foo
### opam install --deps-only --show bar
Nothing to do.
### ::: check ability to install unavailable package :::
### <pkg:a.1>
opam-version: "2.0"
available: false
### <pkg:b.1>
opam-version: "2.0"
depends: "a"
### <pkg:c.1>
opam-version: "2.0"
depends: "b"
### opam install a c --deps-only
[ERROR] Package conflict!
  * Missing dependency:
    - deps-of-c -> b -> a
    unmet availability conditions: 'false'

No solution found, exiting
# Return code 20 #
### opam install c --deps-only
[ERROR] Package conflict!
  * Missing dependency:
    - deps-of-c -> b -> a
    unmet availability conditions: 'false'

No solution found, exiting
# Return code 20 #
### : conflicts :
### <pkg:d.1>
opam-version: "2.0"
depends: "foo"
conflicts: "bar"
### opam install d --deps-only
Nothing to do.
### :::: check if deps-only installed packages are set root ::::
### <pkg:roots1.1>
opam-version: "2.0"
### <pkg:roots2.1>
opam-version: "2.0"
depends: "roots1"
### <pkg:roots3.1>
opam-version: "2.0"
depends: "roots2"
### <pkg:stoor1.1>
opam-version: "2.0"
### <pkg:stoor2.1>
opam-version: "2.0"
depends: "stoor1"
### opam switch create roots --empty
### : deps of a package
### opam install roots3 --deps-only
The following actions will be performed:
=== install 2 packages
  - install roots1 1 [required by roots2]
  - install roots2 1 [required by roots3]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed roots1.1
-> installed roots2.1
Done.
### opam list --roots -s
roots2
### opam remove roots1
The following actions will be performed:
=== remove 2 packages
  - remove roots1 1
  - remove roots2 1 [uses roots1]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> removed   roots2.1
-> removed   roots1.1
Done.
### : deps for 2 package that depend on each other
### opam install roots3 roots2 --deps-only
The following actions will be performed:
=== install 1 package
  - install roots1 1 [required by roots2]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed roots1.1
Done.
### opam list --roots -s
roots1
### opam remove roots1
The following actions will be performed:
=== remove 1 package
  - remove roots1 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> removed   roots1.1
Done.
### : deps for 2 package that depend on each other
### opam install roots3 stoor2 --deps-only | unordered
The following actions will be performed:
=== install 3 packages
  - install roots1 1 [required by roots2]
  - install roots2 1 [required by roots3]
  - install stoor1 1 [required by stoor2]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed roots1.1
-> installed roots2.1
-> installed stoor1.1
Done.
### opam list --roots -s
roots2
stoor1
### opam remove roots1 stoor1 | unordered
The following actions will be performed:
=== remove 3 packages
  - remove roots1 1
  - remove roots2 1 [uses roots1]
  - remove stoor1 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> removed   roots2.1
-> removed   roots1.1
-> removed   stoor1.1
Done.
### : deps with explicite set-root
### opam install roots3 --deps-only --set-root
The following actions will be performed:
=== install 2 packages
  - install roots1 1 [required by roots2]
  - install roots2 1 [required by roots3]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed roots1.1
-> installed roots2.1
Done.
### opam list --roots -s
roots2
### opam remove roots1
The following actions will be performed:
=== remove 2 packages
  - remove roots1 1
  - remove roots2 1 [uses roots1]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> removed   roots2.1
-> removed   roots1.1
Done.
### : deps with explicit unset-root
### opam install roots3 --deps-only --unset-root
The following actions will be performed:
=== install 2 packages
  - install roots1 1 [required by roots2]
  - install roots2 1 [required by roots3]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed roots1.1
-> installed roots2.1
Done.
### opam list --roots -s
### :: Deps-only mechanism for packages that are interdependant.
### :: This test is for checking the behaviour of conflicting or not install or interdependant packages
### : deps of same packages, no version specified
### opam switch create deps-conflictssssssssssssssssss --empty
### <pkg:lorem.1>
opam-version: "2.0"
### <pkg:lorem.2>
opam-version: "2.0"
depends: "sit"
### <pkg:ipsum.1>
opam-version: "2.0"
depends: "lorem" {= "1"}
### <pkg:dolor.1>
opam-version: "2.0"
depends: "ipsum"
### <pkg:sit.1>
opam-version: "2.0"
depopts: "lorem" { < "2" }
### opam install --deps-only lorem dolor
[ERROR] Package conflict!
  * Incompatible packages:
    - deps-of-dolor -> ipsum -> lorem < 2
    - deps-of-lorem

No solution found, exiting
# Return code 20 #
### : deps of same packages, good version specified
### opam switch create deps-conflictsssssssssssssssssss --empty
### <pkg:lorem.1>
opam-version: "2.0"
### <pkg:lorem.2>
opam-version: "2.0"
depends: "sit"
### <pkg:ipsum.1>
opam-version: "2.0"
depends: "lorem" {= "1"}
### <pkg:dolor.1>
opam-version: "2.0"
depends: "ipsum"
### <pkg:sit.1>
opam-version: "2.0"
depopts: "lorem" { < "2" }
### opam install --deps-only lorem.1 dolor.1
[ERROR] Package conflict!
  * Incompatible packages:
    - deps-of-dolor -> ipsum -> lorem < 2
    - deps-of-lorem

No solution found, exiting
# Return code 20 #
### : deps of same packages, uninstallable version specified
### opam switch create deps-conflictssssssssssssssssssss --empty
### <pkg:lorem.1>
opam-version: "2.0"
### <pkg:lorem.2>
opam-version: "2.0"
depends: "sit"
### <pkg:ipsum.1>
opam-version: "2.0"
depends: "lorem" {= "1"}
### <pkg:dolor.1>
opam-version: "2.0"
depends: "ipsum"
### <pkg:sit.1>
opam-version: "2.0"
depopts: "lorem" { < "2" }
### opam install --deps-only lorem.2 dolor.1
[ERROR] Package conflict!
  * Incompatible packages:
    - deps-of-dolor -> ipsum -> lorem < 2
    - deps-of-lorem

No solution found, exiting
# Return code 20 #
### : deps of same packages, no version specified, already installed package
### opam switch create deps-conflictsssssssssssssssssssss --empty
### <pkg:lorem.1>
opam-version: "2.0"
### <pkg:lorem.2>
opam-version: "2.0"
depends: "sit"
### <pkg:ipsum.1>
opam-version: "2.0"
depends: "lorem" {= "1"}
### <pkg:dolor.1>
opam-version: "2.0"
depends: "ipsum"
### <pkg:sit.1>
opam-version: "2.0"
depopts: "lorem" { < "2" }
### opam install lorem.1
The following actions will be performed:
=== install 1 package
  - install lorem 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed lorem.1
Done.
### opam install --deps-only lorem dolor
The following actions will be performed:
=== install 2 packages
  - install ipsum 1 [required by dolor]
  - install sit   1 [required by lorem]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> removed   deps-of-lorem.1
-> installed ipsum.1
-> installed sit.1
Done.
### : deps of same packages, good version specified, already installed package
### opam switch create deps-conflictssssssssssssssssssssss --empty
### <pkg:lorem.1>
opam-version: "2.0"
### <pkg:lorem.2>
opam-version: "2.0"
depends: "sit"
### <pkg:ipsum.1>
opam-version: "2.0"
depends: "lorem" {= "1"}
### <pkg:dolor.1>
opam-version: "2.0"
depends: "ipsum"
### <pkg:sit.1>
opam-version: "2.0"
depopts: "lorem" { < "2" }
### opam install lorem.1
The following actions will be performed:
=== install 1 package
  - install lorem 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed lorem.1
Done.
### opam install --deps-only lorem.1 dolor.1
The following actions will be performed:
=== install 1 package
  - install ipsum 1 [required by dolor]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed ipsum.1
Done.
### : deps of same packages, uninstallable version specified, already installed package
### opam switch create deps-conflictssssssssssssssssssssssss --empty
### <pkg:lorem.1>
opam-version: "2.0"
### <pkg:lorem.2>
opam-version: "2.0"
depends: "sit"
### <pkg:ipsum.1>
opam-version: "2.0"
depends: "lorem" {= "1"}
### <pkg:dolor.1>
opam-version: "2.0"
depends: "ipsum"
### <pkg:sit.1>
opam-version: "2.0"
depopts: "lorem" { < "2" }
### opam install lorem.1
The following actions will be performed:
=== install 1 package
  - install lorem 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed lorem.1
Done.
### opam install --deps-only lorem.2 dolor.1
The following actions will be performed:
=== install 2 packages
  - install ipsum 1 [required by dolor]
  - install sit   1 [required by lorem]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed ipsum.1
-> installed sit.1
Done.
### : other :
### <pkg:lorem.1>
opam-version: "2.0"
depends: "ipsum"
### <pkg:lorem.2>
opam-version: "2.0"
depends: "sit"
### <pkg:ipsum.1>
opam-version: "2.0"
### <pkg:dolor.1>
opam-version: "2.0"
depends: "lorem" {="2"}
### <pkg:dolor.2>
opam-version: "2.0"
depends: "lorem" {="1"}
### <pkg:sit.1>
opam-version: "2.0"
### <pkg:sit.2>
opam-version: "2.0"
### opam switch create deps-conflicts --empty
### # it takes lorem.2 & dolor.1
### opam install --deps-only lorem dolor
The following actions will be performed:
=== install 1 package
  - install sit 2 [required by lorem]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed sit.2
Done.
### opam switch create deps-conflictsss --empty
### # it takes lorem.1
### opam install --deps-only lorem dolor.2
The following actions will be performed:
=== install 1 package
  - install ipsum 1 [required by lorem]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed ipsum.1
Done.
### opam switch create deps-conflictss --empty
### opam install --deps-only lorem.2 dolor.1
The following actions will be performed:
=== install 1 package
  - install sit 2 [required by lorem]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed sit.2
Done.
### opam switch create deps-conflictsssssss --empty
### opam install --deps-only lorem.1 dolor.2
The following actions will be performed:
=== install 1 package
  - install ipsum 1 [required by lorem]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed ipsum.1
Done.
### opam switch create deps-conflictssss --empty
### opam install --deps-only lorem.2 dolor.2
[ERROR] Package conflict!
  * Missing dependency:
    - deps-of-dolor -> deps-of-lorem < 2
    no matching version

No solution found, exiting
# Return code 20 #
### opam switch create deps-conflictsssss --empty
### opam install --deps-only lorem.1 lorem.2
[ERROR] Package conflict!
  * Missing dependency:
    - (request) -> deps-of-lorem
    unknown package

No solution found, exiting
# Return code 20 #
### opam switch create deps-conflictsssssssssssssssss --empty
### opam install lorem.1
The following actions will be performed:
=== install 2 packages
  - install ipsum 1 [required by lorem]
  - install lorem 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed ipsum.1
-> installed lorem.1
Done.
### # it takes lorem.2
### opam install --deps-only dolor.1 lorem
The following actions will be performed:
=== install 1 package
  - install sit 2 [required by lorem]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> removed   deps-of-lorem.1
-> installed sit.2
Done.
