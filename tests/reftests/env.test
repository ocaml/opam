N0REP0
### : Revert env with variable from a package :
### <pkg:nv.1>
opam-version: "2.0"
setenv: [ NV_VARS += "%{_:doc}%:%{_:share}%" ]
flags: compiler
### opam update

<><> Updating package repositories ><><><><><><><><><><><><><><><><><><><><><><>
[default] synchronised from file://${BASEDIR}/REPO
Now run 'opam upgrade' to apply any package updates.
### opam switch create setenv nv

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: ["nv"]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed nv.1
Done.
### opam env | grep "NV_VARS" | '[:;]' -> '-'
NV_VARS='${BASEDIR}/OPAM/setenv/doc/nv-${BASEDIR}/OPAM/setenv/share/nv'- export NV_VARS-
### opam exec -- opam env --revert | grep "NV_VARS" | '[:;]' -> '-'
NV_VARS=''- export NV_VARS-
### NV_VARS=/another/path
### opam env | grep "NV_VARS" | '[:;]' -> '-'
NV_VARS='${BASEDIR}/OPAM/setenv/doc/nv-${BASEDIR}/OPAM/setenv/share/nv-/another/path'- export NV_VARS-
### opam exec -- opam env --revert | grep "NV_VARS" | '[:;]' -> '-'
NV_VARS='/another/path'- export NV_VARS-
### : package variable available at install stage :
### <pkg:nv.1>
opam-version: "2.0"
setenv: [NV_VARS  = "%{_:nv_config}%"]
flags: compiler
### <pkg:nv.1:nv.config>
opam-version: "2.0"
variables { nv_config: "hej!!" }
### opam update

<><> Updating package repositories ><><><><><><><><><><><><><><><><><><><><><><>
[default] synchronised from file://${BASEDIR}/REPO
Now run 'opam upgrade' to apply any package updates.
### opam switch create conffile nv

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: ["nv"]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed nv.1
Done.
### opam env | grep NV_VARS
NV_VARS='hej!!'; export NV_VARS;
### : opam env and its revert :
### opam exec -- opam env | grep '(NV_VARS|OPAMBIN|OPAM_SWITCH_PREFIX)'
OPAM_SWITCH_PREFIX='${BASEDIR}/OPAM/conffile'; export OPAM_SWITCH_PREFIX;
NV_VARS='hej!!'; export NV_VARS;
### opam exec -- opam env --revert | grep '(NV_VARS|OPAMBIN|OPAM_SWITCH_PREFIX)'
OPAM_SWITCH_PREFIX=''; export OPAM_SWITCH_PREFIX;
NV_VARS=''; export NV_VARS;
### opam exec -- env | grep '(NV_VARS|OPAMBIN|OPAM_SWITCH_PREFIX)'
NV_VARS=hej!!
OPAM=${OPAMBIN}
OPAM_SWITCH_PREFIX=${BASEDIR}/OPAM/conffile
### opam exec --no-switch -- env | grep '(NV_VARS|OPAMBIN|OPAM_SWITCH_PREFIX)'
NV_VARS=/another/path
OPAM=${OPAMBIN}
